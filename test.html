<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>üåç Incident Repor Web Application</title>
    <style>
      html,
      body,
      #viewDiv {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
    <link
      rel="stylesheet"
      href="https://js.arcgis.com/4.27/esri/themes/light/main.css"
    />
    <script>
      // *** ‡πÅ‡∏Å‡πâ apiKey ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á
      var esriConfig = {
        apiKey:
          "AAPTxy8BH1VEsoebNVZXo8HurPLXVbze651K5NDgHExQjRqMPlLhNjrtoTuBlKB9p7c2JsBQkR-W9nAqn8b9QOPJFAermqzrchIsAP6kxaVFwkmePrKN7PripcPGYA5r_sJaQ8naMA4pnK5-OlByYQDJ4vMYx27IGCpCx3Q0NWx_ltnOp7EtBgTCEhuM_Ygy_uVzF7qYvcS5eGmmNz2kDxrxmYDGCIJjW0sTkOtS7dVg8OY.AT1_GZQqD3nq",
      };
    </script>
    <script src="https://js.arcgis.com/4.27/"></script>
  </head>
  <body>
    <div id="viewDiv"></div>
 
    <script>
      require([
        "esri/Map",
        "esri/views/MapView",
        "esri/layers/FeatureLayer",
        "esri/widgets/Search",
        "esri/renderers/UniqueValueRenderer",
        "esri/renderers/HeatmapRenderer",
      ], function (Map, MapView, FeatureLayer, Search, UniqueValueRenderer, HeatmapRenderer) {
        // ‡πÇ‡∏à‡∏ó‡∏¢‡πå:
        // 1. ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô API Key ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á Feature Layer ‡∏ó‡∏µ‡πà‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏î‡πâ
        // 2. Add Feature Layer ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Incident ‡πÑ‡∏ß‡πâ ‡∏î‡πâ‡∏ß‡∏¢ Url Map Service ‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á
        // 3. ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ Incident ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å Report ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà ‡πÇ‡∏î‡∏¢‡πÅ‡∏ö‡πà‡∏á‡πÅ‡∏¢‡∏Å Symbol ‡∏ï‡∏≤‡∏° Field: "IncidentType" ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 2 Type ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ
        // ‡πÄ‡∏ä‡πà‡∏ô ‡∏ñ‡πâ‡∏≤ IncidentType ‡πÄ‡∏õ‡πá‡∏ô "‡πÑ‡∏ü‡πÑ‡∏´‡∏°‡πâ" ‡πÉ‡∏´‡πâ Render ‡∏î‡πâ‡∏ß‡∏¢ symbol ‡∏ô‡∏∂‡∏á,  ‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô "‡∏ô‡πâ‡∏≥‡∏ó‡πà‡∏ß‡∏°" ‡πÉ‡∏´‡πâ Render ‡∏≠‡∏µ‡∏Å symbol ‡∏ô‡∏∂‡∏á (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á ‡∏à‡∏∞‡∏Å‡∏≥‡∏´‡∏ô‡∏î type ‡∏≠‡∏∑‡πà‡∏ô‡πÜ‡∏Å‡πá‡πÑ‡∏î‡πâ)
        // 4. ‡πÄ‡∏ß‡∏•‡∏≤ Zoom ‡πÑ‡∏Å‡∏•‡πÜ ‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏õ‡πá‡∏ô Heatmap ‡πÑ‡∏î‡πâ
        // 5. ‡πÄ‡∏ß‡∏•‡∏≤ Zoom ‡πÉ‡∏Å‡∏•‡πâ‡πÜ ‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏õ‡πá‡∏ô Symbol ‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡∏≠‡∏á IncidentType ‡πÑ‡∏î‡πâ
        // 6. ‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ Search Widget ‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Incident ‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏° "‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î, ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á, ‡πÅ‡∏•‡∏∞ ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡∏≠‡∏á Incident"
        // ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ 1 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á
        // Hint: ‡∏î‡∏π‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏Å‡πà‡∏≤‡πÜ ‡∏´‡∏£‡∏∑‡∏≠‡∏î‡∏π‡∏•‡∏¥‡πâ‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏ä‡πà‡∏ß‡∏¢
        // Feature Layer: https://developers.arcgis.com/javascript/latest/sample-code/layers-featurelayer/
        // Render ‡πÅ‡∏ö‡∏ö‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏° type ‡πÉ‡∏ä‡πâ https://developers.arcgis.com/javascript/latest/api-reference/esri-renderers-UniqueValueRenderer.html
        // Render ‡πÅ‡∏ö‡∏ö Heatmap:
        // https://developers.arcgis.com/javascript/latest/sample-code/visualization-heatmap/
        // https://developers.arcgis.com/javascript/latest/api-reference/esri-renderers-HeatmapRenderer.html
        // Search Widget: https://developers.arcgis.com/javascript/latest/sample-code/widgets-search-3d/
 
        const uniqueRender = {
          type: "unique-value",
          field: "IncidentType",
          defaultSymbol: {
            type: "picture-marker",
            url: "https://cdn-icons-png.flaticon.com/512/7334/7334593.png",
            width: "48px",
            height: "48px",
          },
          uniqueValueInfos: [
            {
              value: "‡πÑ‡∏ü‡πÑ‡∏´‡∏°‡πâ",
              symbol: {
                type: "picture-marker",
                url: "https://cdn-icons-png.flaticon.com/512/9922/9922138.png", //‡∏£‡∏π‡∏õ‡πÑ‡∏ü‡πÑ‡∏´‡∏°‡πâ
                width: "48px",
                height: "48px",
              },
            },
            {
              value: "‡∏ô‡πâ‡∏≥‡∏ó‡πà‡∏ß‡∏°",
              symbol: {
                type: "picture-marker",
                url: "https://cdn-icons-png.flaticon.com/512/17639/17639265.png", //‡∏£‡∏π‡∏õ‡∏ô‡πâ‡∏≥‡∏ó‡πà‡∏ß‡∏°
                width: "48px",
                height: "48px",
              },
            },
          ],
        };
 
        const heatmapRenderer = {
          type: "heatmap",
          colorStops: [
            { ratio: 0, color: "rgba(255, 255, 255, 0)" },
            { ratio: 0.2, color: "rgba(255, 255, 255, 1)" },
            { ratio: 0.5, color: "rgba(255, 140, 0, 1)" },
            { ratio: 0.8, color: "rgba(255, 140, 0, 1)" },
            { ratio: 1, color: "rgba(255, 0, 0, 1)" },
          ],
          minDensity: 0,
          maxDensity: 0.01,
          radius: 10,
        };
 
        // üîπ Define Pin Renderer
        const pinRenderer = {
          type: "simple",
          symbol: {
            type: "picture-marker",
            url: "https://cdn-icons-png.flaticon.com/512/7334/7334593.png",
            width: "48px",
            height: "48px",
          },
        };
 
        // ‡∏™‡∏£‡πâ‡∏≤‡∏á FeatureLayer
        const incidentFeatureLayer = new UniqueValueRenderer({
          url: "https://services.arcgis.com/7DuUQqhsHnXFy4Oz/arcgis/rest/services/IncidentLayer/FeatureServer",
          outFields: ["*"],
          renderer: heatmapRenderer,
          popupTemplate: {
            title: "{IncidentType}",
            content: `
            <b>üìç ‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏´‡∏ï‡∏∏:</b> {Reporter} <br>
            <b>‚≠ê ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:</b> {Description} <br>
          `,
          },
        });
 
        // üîπ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
        const map = new Map({
          basemap: "streets-navigation-vector",
          layers: [incidentFeatureLayer],
        });
 
        // üîπ ‡∏™‡∏£‡πâ‡∏≤‡∏á View
        const view = new MapView({
          container: "viewDiv",
          map: map,
          center: [100.5231, 13.7367], // ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏Å‡∏•‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø
          zoom: 12,
        });
 
        const searchWidget = new Search({
          view: view,
          sources: [
            {
              layer: incidentFeatureLayer,
              name: "Search Incident", // ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á data source
              searchFields: ["IncidentType", "Reporter", "Description"],
              displayField: "IncidentType",
              exactMatch: false,
              outFields: ["*"],
              placeholder: "üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏£‡πâ‡∏≤‡∏ô‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå...",
              suggestionTemplate: "{IncidentType} - {Reporter} - {Description}",
              popupTemplate: {
                title: "{IncidentType}",
                content: `
                 <b>üìç ‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏´‡∏ï‡∏∏:</b> {Reporter} <br>
                 <b>‚≠ê ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:</b> {Description} <br>
                 `,
              },
            },
          ],
        });
        view.ui.add(searchWidget, {
          position: "top-right",
        });
 
        // üîπ Change Renderer on Zoom
        view.watch("zoom", function (newZoom) {
          if (newZoom >= 15) {
            incidentFeatureLayer.renderer = uniqueRender; // Switch to pin renderer at higher zoom levels
          } else {
            incidentFeatureLayer.renderer = heatmapRenderer; // Use heatmap renderer at lower zoom levels
          }
        });
      });
    </script>
  </body>
</html>
 