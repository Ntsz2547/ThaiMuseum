<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Thai Museum</title>
    <style>
      html,
      body,
      #viewDiv {
        height: 100%;
        margin: 0;
        padding: 0;
      }

      .esri-widget {
        font-family: Arial, sans-serif;
      }

      .custom-search {
        position: absolute;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 10;
      }
    </style>
    <link
      rel="stylesheet"
      href="https://js.arcgis.com/4.27/esri/themes/light/main.css"
    />
    <script>
      var esriConfig = {
        apiKey:
          "AAPTxy8BH1VEsoebNVZXo8HurNJ2CoRxo3i6iJz33op9AG1zeCNpOwDjKVYK1VHCgh1LUCVtfbdVkdkkvpWDmaWXLvkWKiksNoI2IK53z9R_Sh8v7J-JEVVTJvtNt6QE8_EMQR5pJIUKK1go9gBVRynJiUhq0lif0TP2nG0syUcHlr_VbTuEdrAoVbnuPy_sSRi94St6vV9gjiMCctpQ37CPkDnOHPPzk7YzLpDtQ2LFrGI.AT1_JiJunJN8",
      };
    </script>
    <script src="https://js.arcgis.com/4.27/"></script>
  </head>
  <body>
    <div id="viewDiv"></div>

    <script>
      require([
        "esri/Map",
        "esri/views/MapView",
        "esri/layers/FeatureLayer",
        "esri/layers/CSVLayer",
        "esri/renderers/UniqueValueRenderer",
        "esri/widgets/Editor",
        "esri/widgets/Search",
        "esri/widgets/Sketch",
        "esri/widgets/Expand",
        "esri/layers/GraphicsLayer",
      ], function (
        Map,
        MapView,
        FeatureLayer,
        CSVLayer,
        UniqueValueRenderer,
        Editor,
        Search,
        Sketch,
        Expand,
        GraphicsLayer
      ) {
        const museumFeatureLayer = new FeatureLayer({
          url: "https://services2.arcgis.com/6BFEWLVwrkq1Nfkk/arcgis/rest/services/MuseLayer/FeatureServer",
          outFields: ["*"],
          popupTemplate: {
            title: "{Name}",
            content: `
              <b>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:</b> üèõÔ∏è {MuseType}<br>
              <b>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î:</b> üìç {Province}<br>
              <b>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:</b> üìù {Description}<br>
              <b>‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏Å‡∏≤‡∏£:</b> ‚è∞ {OpenHours}<br>
            `,
          },
        });

        const csvLayer = new CSVLayer({
          url: "./thai_museums.csv",
          popupTemplate: {
            title: "{Name}",
            content: `
              <b>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:</b> üèõÔ∏è {MuseType}<br>
              <b>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î:</b> üìç {Province}<br>
              <b>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:</b> üìù {Description}<br>
              <b>‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏Å‡∏≤‡∏£:</b> ‚è∞ {OpenHours}<br>
              <img src="{ImageURL}" width="200px">
            `,
          },
        });

        const map = new Map({
          basemap: "streets-navigation-vector",
          layers: [museumFeatureLayer, csvLayer],
        });

        const view = new MapView({
          container: "viewDiv",
          map: map,
          center: [100.523816, 13.728993],
          zoom: 13,
        });

        // Move Zoom Widget to bottom-right
        view.ui.move("zoom", "bottom-right");

        // Add Search Widget
        const searchWidget = new Search({
          view: view,
          includeDefaultSources: false,
          sources: [
            {
              layer: museumFeatureLayer,
              name: "Found Museum",
              searchFields: ["Name", "Province"],
              displayField: "Name",
              exactMatch: false,
              outFields: ["Name", "Province", "MuseType", "Description", "ImageURL"],
              placeholder: "üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏û‡∏¥‡∏û‡∏¥‡∏ò‡∏†‡∏±‡∏ì‡∏ë‡πå‡πÉ‡∏ô Feature Layer...",
              suggestionTemplate: "{Name} - {Province}",
              popupTemplate: {
                title: "{Name}",
                content: `
                  <b>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:</b> {MuseType}<br>
                  <b>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î:</b> {Province}<br>
                  <b>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:</b> {Description}<br>
                  <img src="{ImageURL}" width="200px">
                `,
              },
            },
          ],
        });

        const searchExpand = new Expand({
          view: view,
          content: searchWidget,
          expandIconClass: "esri-icon-search",
          expandTooltip: "Search Museums",
        });

        view.ui.add(searchExpand, "top-right");

        // Add Sketch Widget
        const graphicsLayer = new GraphicsLayer();
        map.add(graphicsLayer);

        const sketch = new Sketch({
          view: view,
          layer: graphicsLayer,
        });

        const sketchExpand = new Expand({
          view: view,
          content: sketch,
          expandIconClass: "esri-icon-edit",
          expandTooltip: "Draw shapes to filter museums",
        });

        view.ui.add(sketchExpand, "top-left");
      });
    </script>
  </body>
</html>